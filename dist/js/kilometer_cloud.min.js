"use strict";angular.module("ngLocale",[],["$provide",function(a){function b(a){a+="";var b=a.indexOf(".");return-1==b?0:a.length-b-1}function c(a,c){var d=c;void 0===d&&(d=Math.min(b(a),3));var e=Math.pow(10,d),f=(a*e|0)%e;return{v:d,f:f}}var d={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};a.value("$locale",{DATETIME_FORMATS:{AMPMS:["a.m.","p.m."],DAY:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],ERANAMES:["voor Christus","na Christus"],ERAS:["v.Chr.","n.Chr."],FIRSTDAYOFWEEK:0,MONTH:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],SHORTDAY:["zo","ma","di","wo","do","vr","za"],SHORTMONTH:["jan.","feb.","mrt.","apr.","mei","jun.","jul.","aug.","sep.","okt.","nov.","dec."],STANDALONEMONTH:["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],WEEKENDRANGE:[5,6],fullDate:"EEEE d MMMM y",longDate:"d MMMM y",medium:"d MMM y HH:mm:ss",mediumDate:"d MMM y",mediumTime:"HH:mm:ss","short":"dd-MM-yy HH:mm",shortDate:"dd-MM-yy",shortTime:"HH:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"€",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"¤ -",negSuf:"",posPre:"¤ ",posSuf:""}]},id:"nl-nl",localeID:"nl_NL",pluralCat:function(a,b){var e=0|a,f=c(a,b);return 1==e&&0==f.v?d.ONE:d.OTHER}})}]),function(){function a(a,b,c,d){var e=a.defer();return b.get("/api/v1/protected/ping").success(function(a){d.setLoggedin(!0),a.jwt&&d.setJwt(a.jwt),a.id_user&&d.setUserId(a.id_user),a.user_data&&d.setUserData(a.user_data),e.resolve()}).error(function(){d.setLoggedin(!1),d.deleteJwt(),d.deleteUserData(),e.reject(),"/register"!=c.path()&&c.path("/login")}),e.promise}function b(b,c,d,e){b.interceptors.push("httpRequestInterceptor"),c.when("/login",{templateUrl:"assets/views/login.html",controller:"loginController",controllerAs:"vm"}).when("/register",{templateUrl:"assets/views/register.html",controller:"registerController",controllerAs:"vm"}).when("/",{templateUrl:"assets/views/home.html",controller:"homeController",controllerAs:"ctrl",resolve:{loggedin:a}}).when("/start",{templateUrl:"assets/views/start.html",controller:"startController",controllerAs:"ctrl",resolve:{loggedin:a}}).when("/logout",{templateUrl:"assets/views/logout.html",controller:"logoutController",controllerAs:"vm",resolve:{loggedin:a}}).when("/routes",{templateUrl:"assets/views/routes.html",controller:"routesController",controllerAs:"vm",resolve:{loggedin:a}}).when("/routes/edit/:id",{templateUrl:"assets/views/routes/edit.html",controller:"routesEditController",controllerAs:"vm",resolve:{loggedin:a}}).when("/routes/view/:id",{templateUrl:"assets/views/routes/view.html",controller:"routesViewController",controllerAs:"vm",resolve:{loggedin:a}}),d.html5Mode(!0),e.configure({key:"AIzaSyC83qOwsQ6dCRP9TlWoklYl2k63LN3zdLI"})}function c(a){var b={loggedin:!1,setLoggedin:function(a){b.loggedin=a},setJwt:function(b){a.jwt=b},getJwt:function(){return a.jwt},setUserId:function(b){a.id_user=b},getUserId:function(){return a.id_user},deleteJwt:function(){a.jwt=void 0},setUserData:function(b){a.user_data=b},getUserData:function(){return a.user_data},deleteUserData:function(){a.user_data=void 0}};return b}function d(a){return{request:function(b){return a.getJwt()&&(b.headers?b.headers.Authorization="Bearer "+a.getJwt():b.headers={Authorization:"Bearer "+a.getJwt()}),b}}}function e(){return function(a){return a.replace(/(.+) (.+)/,"$1T$2Z")}}function f(a){var b=[];return function(c,d){if(c===!0){if(b.length<1)return b=[],a.get("/api/v1/protected/ping");var e=b;return b=[],a.post("/api/v1/protected/route-part",{part:e})}b.push({lat:c,lng:d}),b.length>=10&&(a.post("/api/v1/protected/route-part",{part:b}),b=[])}}angular.module("kmApp",["ngRoute","uiGmapgoogle-maps","ngStorage","angularUtils.directives.dirPagination"]).config(b).filter("dateToISO",e).directive("selectOnClick",["$window",function(a){return{restrict:"A",link:function(b,c,d){c.on("click",function(){a.getSelection().toString()||this.setSelectionRange(0,this.value.length)})}}}]).factory("authFactory",c).factory("httpRequestInterceptor",d).factory("saveRoutePart",f).run(["$q","$http","$location","authFactory","$interval",function(a,b,c,d,e){b.get("/api/v1/protected/ping").success(function(a){d.setLoggedin(!0),a.jwt&&d.setJwt(a.jwt),a.id_user&&d.setUserId(a.id_user),a.user_data&&d.setUserData(a.user_data)}).error(function(){d.setLoggedin(!1),d.deleteJwt(),d.deleteUserData(),"/register"!=c.path()&&c.path("/login")}),e(function(){b.get("/api/v1/protected/ping").success(function(a){d.setLoggedin(!0),a.jwt&&d.setJwt(a.jwt),a.id_user&&d.setUserId(a.id_user),a.user_data&&d.setUserData(a.user_data)}).error(function(){d.setLoggedin(!1),d.deleteJwt(),d.deleteUserData(),"/register"!=c.path()&&c.path("/login")})},3e4)}]),a.$inject=["$q","$http","$location","authFactory"],b.$inject=["$httpProvider","$routeProvider","$locationProvider","uiGmapGoogleMapApiProvider"],c.$inject=["$sessionStorage"],d.$inject=["authFactory"],f.$inject=["$http"]}(),function(){function a(a,b){var c=this;c.user=b.getUserData(),c.start=function(){a.path("/start")},c.history=function(){a.path("/routes")},c.logout=function(){a.path("/logout")}}angular.module("kmApp").controller("homeController",a),a.$inject=["$location","authFactory"]}(),function(){function a(a,b,c){var d=this;d.username="",d.password="",d.doLogin=function(){return d.username&&d.password?void a({method:"POST",url:"/api/v1/auth/login",data:{username:d.username,password:d.password}}).success(function(a){b.setJwt(a.jwt),b.setUserId(a.id_user),c.path("/")}).error(function(a){alert(a.message)}):void alert("Zorg ervoor dat de gebruikersnaam en het wachtwoord zijn ingevuld.")},d.gotoRegister=function(){c.path("/register")}}angular.module("kmApp").controller("loginController",a),a.$inject=["$http","authFactory","$location"]}(),function(){function a(a,b){b.deleteJwt(),a.path("/login")}angular.module("kmApp").controller("logoutController",a),a.$inject=["$location","authFactory"]}(),function(){function a(a,b){var c=this;c.user={},c.doRegister=function(){return c.user.username&&c.user.email&&c.user.password1&&c.user.password2&&c.user.firstname&&c.user.lastname?c.password1!=c.password2?void alert("De wachtwoorden moeten overeen komen."):void a.post("/api/v1/auth/register",c.user).success(function(a){alert("Uw account is aangemaakt.\nEr is een activatie email verzonden."),b.path("/")}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het aanmaken van uw account.")}):void alert("Vul alle verplichten velden in.")},c.gotoLogin=function(){b.path("/login")}}angular.module("kmApp").controller("registerController",a),a.$inject=["$http","$location"]}(),function(){function a(a,b,c,d){function e(b){a.get("/api/v1/protected/routes?page="+b+"&month="+g.filter.month+"&year="+g.filter.year+"&paid="+g.filter.paid).success(function(a){g.routes=a.routes,g.totals=a.totals,g.totalRoutes=a.totals.count,g.filter=a.filter}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het ophalen van de ritten, probeer het later nog een keer.")})}function f(){var a=[];return angular.forEach(g.checked,function(b,c){b===!0&&a.push(c)}),a}var g=this;g.user=d.getUserData(),g.routes=[],g.checked=[],g.totals=[];var h=new Date;g.filter={month:(h.getMonth()+1).toString(),year:h.getFullYear().toString(),paid:"0"},g.totalRoutes=0,g.routesPerPage=10,g.pagination={current:1},e(1),g.back=function(){console.log(g.checked),b.path("/")},g.pageChanged=function(a){e(a)},g.checkAll=function(){g.selectedAll?g.selectedAll=!0:g.selectedAll=!1,angular.forEach(g.routes,function(a){g.checked[a.id_route]=g.selectedAll})},g.showAction=function(){var a=c("filter")(g.checked,!0);return a.length},g.filterSubmit=function(){e(1)},g.view=function(a){b.path("/routes/view/"+a.id_route)},g.edit=function(a){b.path("/routes/edit/"+a.id_route)},g["delete"]=function(b){confirm("Weet u zeker dat u de rit wilt verwijderen?")&&a["delete"]("/api/v1/protected/route?id_route="+b.id_route).success(function(a){e(g.pagination.current),alert("De rit is succesvol verwijderd.")}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het verwijderen van de rit.")})},g.batchPay=function(b){var c=f();a.put("/api/v1/protected/batch/routes/paid-status",{routes:c,status:b}).success(function(a){e(g.pagination.current),g.selectedAll=!1,g.checked=[]}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het aanpassen van de betaald status.")})},g.batchDelete=function(){if(!confirm("Weet u zeker dat u deze ritten wilt verwijderen?"))return void(g.checked=[]);var b=f();a["delete"]("/api/v1/protected/batch/routes/delete?routes="+JSON.stringify(b)).success(function(a){e(g.pagination.current),g.selectedAll=!1}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het verwijderen van de ritten.")})}}angular.module("kmApp").controller("routesController",a),a.$inject=["$http","$location","$filter","authFactory"]}(),function(){function a(a,b,c,d){var e=this;e.user=d.getUserData(),e.id_route=a.id,e.description="",e.paid=0,e.id_route||b.path("/routes"),c.get("/api/v1/protected/route?id_route="+e.id_route).success(function(a){e.description=a.route.omschrijving,e.paid=a.route.betaald}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het laden van de rit gegevens.")}),e.save=function(){c.put("/api/v1/protected/route",{id_route:e.id_route,description:e.description,paid:e.paid}).success(function(a){b.path("/routes")}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het opslaan van de rit.")})},e.back=function(){b.path("/routes")}}angular.module("kmApp").controller("routesEditController",a),a.$inject=["$routeParams","$location","$http","authFactory"]}(),function(){function a(a,b,c,d,e,f){var g=this;g.user=f.getUserData(),g.id_route=c.id,g.route={},g.map={center:{latitude:52.092876,longitude:5.10448},zoom:8,control:{}},g.id_route||b.path("/routes");var h;d.then(function(b){e.promise(1).then(function(c){var d=c[0].map;h=new b.Polyline({geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,map:d}),a.get("/api/v1/protected/route?id_route="+g.id_route).success(function(a){if(g.route=a.route,!g.route.route)return void alert("De route kan niet worden weergegeven op de kaart.\nMogelijk is deze rit handmatig ingevoerd.");h.setPath(g.route.route),console.log(g.route.route),g.map.center.latitude=g.route.route[0].lat,g.map.center.longitude=g.route.route[0].lng,d.setZoom(14);new b.Marker({position:g.route.route[0],map:d,title:"Start"})}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het laden van de rit gegevens.")})})}),g.back=function(){b.path("/routes")}}angular.module("kmApp").controller("routesViewController",a),a.$inject=["$http","$location","$routeParams","uiGmapGoogleMapApi","uiGmapIsReady","authFactory"]}(),function(){function a(a,c,e,f,g,h,i){var j=this;j.user=h.getUserData(),j.map={center:{latitude:52.092876,longitude:5.10448},zoom:8,control:{}},j.speed=0;var k=[];j.distance=0;var l=new Date;return l=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate()+" "+l.getHours()+":"+l.getMinutes()+":"+l.getSeconds(),console.log("Start datetime: "+l),navigator.geolocation?(a.then(function(a){c.promise(1).then(function(c){var e=c[0].map,f=new a.Polyline({geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,map:e});navigator.geolocation.getCurrentPosition(function(c){new a.Marker({position:{lat:c.coords.latitude,lng:c.coords.longitude},map:e,title:"Start"});k.push({lat:c.coords.latitude,lng:c.coords.longitude}),f.setPath(k),i(c.coords.latitude,c.coords.longitude),e.setCenter({lat:c.coords.latitude,lng:c.coords.longitude}),e.setZoom(16);var g=Date.now()/1e3;navigator.geolocation.watchPosition(function(a){var c=b(k[k.length-1].lat,k[k.length-1].lng,a.coords.latitude,a.coords.longitude);j.distance=j.distance+c,j.speed=d(g,Date.now()/1e3,c),k.push({lat:a.coords.latitude,lng:a.coords.longitude}),f.setPath(k),i(a.coords.latitude,a.coords.longitude),e.setCenter({lat:a.coords.latitude,lng:a.coords.longitude}),g=Date.now()/1e3},null,{enableHighAccuracy:!0})},null,{enableHighAccuracy:!0})})}),j["delete"]=function(){confirm("Weet u zeker dat u de route wilt verwijderen?")&&e.path("/")},void(j.save=function(){return confirm("Weet u zeker dat u de route wilt opslaan?")?k.length<1?void alert("De route is nog te kort om op te slaan."):void i(!0).then(function(a){f({method:"POST",url:"/api/v1/protected/route",data:g({kms:j.distance,start_date:l}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){alert("De route is opgeslagen!"),e.path("/")},function(a){console.log(a),alert("Er is iets fout gegaan tijdens het opslaan van de route")})},function(a){console.log(a),alert("Er is een fout opgetreden tijdens het opslaan van de route")}):void 0})):void alert("Uw browser wordt niet ondersteund!")}function b(a,b,d,e){var f=6371,g=c(d-a),h=c(e-b),i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(c(a))*Math.cos(c(d))*Math.sin(h/2)*Math.sin(h/2),j=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),k=f*j;return k>.5?0:k}function c(a){return a*(Math.PI/180)}function d(a,b,c){return a=a/60/60,b=b/60/60,c/(b-a)}angular.module("kmApp").controller("startController",a),a.$inject=["uiGmapGoogleMapApi","uiGmapIsReady","$location","$http","$httpParamSerializer","authFactory","saveRoutePart"]}();