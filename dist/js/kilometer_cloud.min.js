"use strict";angular.module("ngLocale",[],["$provide",function(a){function b(a){a+="";var b=a.indexOf(".");return-1==b?0:a.length-b-1}function c(a,c){var d=c;void 0===d&&(d=Math.min(b(a),3));var e=Math.pow(10,d),f=(a*e|0)%e;return{v:d,f:f}}var d={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};a.value("$locale",{DATETIME_FORMATS:{AMPMS:["a.m.","p.m."],DAY:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],ERANAMES:["voor Christus","na Christus"],ERAS:["v.Chr.","n.Chr."],FIRSTDAYOFWEEK:0,MONTH:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],SHORTDAY:["zo","ma","di","wo","do","vr","za"],SHORTMONTH:["jan.","feb.","mrt.","apr.","mei","jun.","jul.","aug.","sep.","okt.","nov.","dec."],STANDALONEMONTH:["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],WEEKENDRANGE:[5,6],fullDate:"EEEE d MMMM y",longDate:"d MMMM y",medium:"d MMM y HH:mm:ss",mediumDate:"d MMM y",mediumTime:"HH:mm:ss","short":"dd-MM-yy HH:mm",shortDate:"dd-MM-yy",shortTime:"HH:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"€",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"¤ -",negSuf:"",posPre:"¤ ",posSuf:""}]},id:"nl-nl",localeID:"nl_NL",pluralCat:function(a,b){var e=0|a,f=c(a,b);return 1==e&&0==f.v?d.ONE:d.OTHER}})}]),function(){function a(a,b,c,d){var e=a.defer();return b.get("/api/v1/protected/ping").success(function(a){d.setLoggedin(!0),d.setJwt(a.jwt),e.resolve()}).error(function(){d.setLoggedin(!1),d.deleteJwt(),e.reject(),c.path("/login")}),e.promise}function b(b,c,d,e){b.interceptors.push("httpRequestInterceptor"),c.when("/login",{templateUrl:"assets/views/login.html",controller:"loginController",controllerAs:"vm"}).when("/",{templateUrl:"assets/views/home.html",controller:"homeController",controllerAs:"ctrl",resolve:{loggedin:a}}).when("/start",{templateUrl:"assets/views/start.html",controller:"startController",controllerAs:"ctrl",resolve:{loggedin:a}}).when("/logout",{templateUrl:"assets/views/logout.html",controller:"logoutController",controllerAs:"vm",resolve:{loggedin:a}}).when("/routes",{templateUrl:"assets/views/routes.html",controller:"routesController",controllerAs:"vm",resolve:{loggedin:a}}).when("/routes/edit/:id",{templateUrl:"assets/views/routes/edit.html",controller:"routesEditController",controllerAs:"vm",resolve:{loggedin:a}}).when("/routes/view/:id",{templateUrl:"assets/views/routes/view.html",controller:"routesViewController",controllerAs:"vm",resolve:{loggedin:a}}),d.html5Mode(!0),e.configure({key:"AIzaSyC83qOwsQ6dCRP9TlWoklYl2k63LN3zdLI"})}function c(a){var b={loggedin:!1,id_user:0,setLoggedin:function(a){b.loggedin=a},setJwt:function(b){a.jwt=b},getJwt:function(){return a.jwt},setUserId:function(a){b.id_user=a},getUserId:function(){return b.id_user},deleteJwt:function(){a.jwt=void 0}};return b}function d(a){return{request:function(b){return a.getJwt()&&(b.headers?b.headers.Authorization="Bearer "+a.getJwt():b.headers={Authorization:"Bearer "+a.getJwt()}),b}}}function e(){return function(a){return a.replace(/(.+) (.+)/,"$1T$2Z")}}angular.module("kmApp",["ngRoute","uiGmapgoogle-maps","ngStorage","angularUtils.directives.dirPagination"]).config(b).filter("dateToISO",e).directive("selectOnClick",["$window",function(a){return{restrict:"A",link:function(b,c,d){c.on("click",function(){a.getSelection().toString()||this.setSelectionRange(0,this.value.length)})}}}]).factory("authFactory",c).factory("httpRequestInterceptor",d).run(["$q","$http","$location","authFactory","$interval",function(a,b,c,d,e){b.get("/api/v1/protected/ping").success(function(a){d.setLoggedin(!0),d.setJwt(a.jwt)}).error(function(){d.setLoggedin(!1),d.deleteJwt(),c.path("/login")}),e(function(){b.get("/api/v1/protected/ping").success(function(a){d.setLoggedin(!0),d.setJwt(a.jwt)}).error(function(){d.setLoggedin(!1),d.deleteJwt(),c.path("/login")})},3e4)}]),a.$inject=["$q","$http","$location","authFactory"],b.$inject=["$httpProvider","$routeProvider","$locationProvider","uiGmapGoogleMapApiProvider"],c.$inject=["$sessionStorage"],d.$inject=["authFactory"]}(),function(){function a(a){var b=this;b.start=function(){a.path("/start")},b.history=function(){a.path("/routes")},b.logout=function(){a.path("/logout")}}angular.module("kmApp").controller("homeController",a),a.$inject=["$location"]}(),function(){function a(a,b,c){var d=this;d.username="",d.password="",d.doLogin=function(){return d.username&&d.password?void a({method:"POST",url:"/api/v1/auth/login",data:{username:d.username,password:d.password}}).success(function(a){b.setJwt(a.jwt),b.setUserId(a.id_user),c.path("/")}).error(function(a){alert(a.message)}):void alert("Zorg ervoor dat de gebruikersnaam en het wachtwoord zijn ingevuld.")}}angular.module("kmApp").controller("loginController",a),a.$inject=["$http","authFactory","$location"]}(),function(){function a(a,b){b.deleteJwt(),a.path("/login")}angular.module("kmApp").controller("logoutController",a),a.$inject=["$location","authFactory"]}(),function(){function a(a,b,c){function d(b){a.get("/api/v1/protected/routes?page="+b).success(function(a){f.routes=a.routes,f.totals=a.totals,f.totalRoutes=a.totals.count}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het ophalen van de ritten, probeer het later nog een keer.")})}function e(){var a=[];return angular.forEach(f.checked,function(b,c){b===!0&&a.push(c)}),a}var f=this;f.routes=[],f.checked=[],f.totals=[],f.totalRoutes=0,f.routesPerPage=10,f.pagination={current:1},d(1),f.back=function(){console.log(f.checked),b.path("/")},f.pageChanged=function(a){d(a)},f.checkAll=function(){f.selectedAll?f.selectedAll=!0:f.selectedAll=!1,angular.forEach(f.routes,function(a){f.checked[a.id_route]=f.selectedAll})},f.showAction=function(){var a=c("filter")(f.checked,!0);return a.length},f.view=function(a){b.path("/routes/view/"+a.id_route)},f.edit=function(a){b.path("/routes/edit/"+a.id_route)},f["delete"]=function(b){confirm("Weet u zeker dat u de rit wilt verwijderen?")&&a["delete"]("/api/v1/protected/route?id_route="+b.id_route).success(function(a){d(f.pagination.current),alert("De rit is succesvol verwijderd.")}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het verwijderen van de rit.")})},f.batchPay=function(b){var c=e();a.put("/api/v1/protected/batch/routes/paid-status",{routes:c,status:b}).success(function(a){d(f.pagination.current),f.checked=[]}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het aanpassen van de betaald status.")})},f.batchDelete=function(){if(!confirm("Weet u zeker dat u deze ritten wilt verwijderen?"))return void(f.checked=[]);var b=e();a["delete"]("/api/v1/protected/batch/routes/delete?routes="+JSON.stringify(b)).success(function(a){d(f.pagination.current)}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het verwijderen van de ritten.")})}}angular.module("kmApp").controller("routesController",a),a.$inject=["$http","$location","$filter"]}(),function(){function a(a,b,c){var d=this;d.id_route=a.id,d.description="",d.paid=0,d.id_route||b.path("/routes"),c.get("/api/v1/protected/route?id_route="+d.id_route).success(function(a){d.description=a.route.omschrijving,d.paid=a.route.betaald}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het laden van de rit gegevens.")}),d.save=function(){c.put("/api/v1/protected/route",{id_route:d.id_route,description:d.description,paid:d.paid}).success(function(a){b.path("/routes")}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het opslaan van de rit.")})},d.back=function(){b.path("/routes")}}angular.module("kmApp").controller("routesEditController",a),a.$inject=["$routeParams","$location","$http"]}(),function(){function a(a,b,c,d,e){var f=this;f.id_route=c.id,f.route={},f.map={center:{latitude:52.092876,longitude:5.10448},zoom:8,control:{}},f.id_route||b.path("/routes");var g;d.then(function(b){e.promise(1).then(function(c){var d=c[0].map;g=new b.Polyline({geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,map:d}),a.get("/api/v1/protected/route?id_route="+f.id_route).success(function(a){if(f.route=a.route,!f.route.route)return void alert("De route kan niet worden weergegeven op de kaart.\nMogelijk is deze rit handmatig ingevoerd.");g.setPath(f.route.route),console.log(f.route.route),f.map.center.latitude=f.route.route[0].lat,f.map.center.longitude=f.route.route[0].lng,d.setZoom(14);new b.Marker({position:f.route.route[0],map:d,title:"Start"})}).error(function(a){console.log(a),alert("Er is een fout opgetreden tijdens het laden van de rit gegevens.")})})}),f.back=function(){b.path("/routes")}}angular.module("kmApp").controller("routesViewController",a),a.$inject=["$http","$location","$routeParams","uiGmapGoogleMapApi","uiGmapIsReady"]}(),function(){function a(a,c,e,f,g,h){var i=this;i.map={center:{latitude:52.092876,longitude:5.10448},zoom:8,control:{}},i.speed=0;var j=[];i.distance=0;var k=new Date;return k=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate()+" "+k.getHours()+":"+k.getMinutes()+":"+k.getSeconds(),console.log("Start datetime: "+k),navigator.geolocation?(a.then(function(a){c.promise(1).then(function(c){var e=c[0].map,f=new a.Polyline({geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,map:e});navigator.geolocation.getCurrentPosition(function(c){new a.Marker({position:{lat:c.coords.latitude,lng:c.coords.longitude},map:e,title:"Start"});j.push({lat:c.coords.latitude,lng:c.coords.longitude}),f.setPath(j),e.setCenter({lat:c.coords.latitude,lng:c.coords.longitude}),e.setZoom(16);var g=Date.now()/1e3;navigator.geolocation.watchPosition(function(a){var c=b(j[j.length-1].lat,j[j.length-1].lng,a.coords.latitude,a.coords.longitude);i.distance=i.distance+c,i.speed=d(g,Date.now()/1e3,c),j.push({lat:a.coords.latitude,lng:a.coords.longitude}),f.setPath(j),e.setCenter({lat:a.coords.latitude,lng:a.coords.longitude}),g=Date.now()/1e3},null,{enableHighAccuracy:!0})},null,{enableHighAccuracy:!0})})}),i["delete"]=function(){confirm("Weet u zeker dat u de route wilt verwijderen?")&&e.path("/")},void(i.save=function(){return confirm("Weet u zeker dat u de route wilt opslaan?")?j.length<1?void alert("De route is nog te kort om op te slaan."):void f({method:"POST",url:"/api/v1/protected/route",data:g({kms:i.distance,route:JSON.stringify(j),start_date:k,id_user:h.getUserId()}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){alert("De route is opgeslagen!"),e.path("/")},function(a){console.log(a),alert("Er is iets fout gegaan tijdens het opslaan van de route")}):void 0})):void alert("Uw browser wordt niet ondersteund!")}function b(a,b,d,e){var f=6371,g=c(d-a),h=c(e-b),i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(c(a))*Math.cos(c(d))*Math.sin(h/2)*Math.sin(h/2),j=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),k=f*j;return k>.5?0:k}function c(a){return a*(Math.PI/180)}function d(a,b,c){return a=a/60/60,b=b/60/60,c/(b-a)}angular.module("kmApp").controller("startController",a),a.$inject=["uiGmapGoogleMapApi","uiGmapIsReady","$location","$http","$httpParamSerializer","authFactory"]}();